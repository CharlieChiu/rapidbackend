<?xml version="1.0" encoding="UTF-8"?>
<beans 
  xmlns="http://www.springframework.org/schema/beans"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:context="http://www.springframework.org/schema/context"
  xmlns:tx="http://www.springframework.org/schema/tx"
  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-2.5.xsd
        http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.5.xsd">
<bean id="TestSchema" class="com.rapidbackend.core.request.RequestSchema">
  <property name="requiredParams" value="userId,content,password"></property>
  <property name="optionalParams" value="sessionId"></property>
  <property name="command" value="Test"></property>
  <property name="autowireModelPropertyAsParam" value="true"></property>
  <property name="modelName" value="feed"></property><!-- this property must be set if autowireModelPropertyAsParam's been set to true -->
</bean>

<bean id="LoginSchema" class="com.rapidbackend.core.request.RequestSchema">
  <property name="requiredParams" value="userId"></property>
  <property name="optionalParams" value="sessionId"></property>
  <property name="command" value="Login"></property>
  <property name="autowireModelPropertyAsParam" value="true"></property>
  <property name="modelName" value="feed"></property><!-- this property must be set if autowireModelPropertyAsParam's been set to true -->
</bean>

<bean id="sessionId" class="com.rapidbackend.core.request.StringParam" />
<bean id="password" class="com.rapidbackend.core.request.StringParam" />
<bean id="userId" class="com.rapidbackend.core.request.IntParam"/>
<bean id="content" class="com.rapidbackend.core.request.StringParam"/>

<bean id="TestPipeline" class="com.rapidbackend.core.process.StandardPipeline">
    <property name="timeout" value="1200000"></property><!-- command timeout -->
    <property name="handlers">
        <list>
            <ref bean="SessionInitHandler"/>
            <ref bean="LoginDemoHandler"/>
            <ref bean="SessionStoreHandler"/>
        </list>
    </property>
</bean>
<bean id="LoginPipeline" class="com.rapidbackend.core.process.StandardPipeline">
    <property name="timeout" value="1200000"></property><!-- command timeout -->
    <property name="handlers">
        <list>
            <ref bean="SessionInitHandler"/>
            <ref bean="LoginDemoHandler"/>
            <ref bean="SessionStoreHandler"/>
        </list>
    </property>
</bean>
<bean id="LoginDemoHandler" class="com.rapidbackend.core.process.handler.LoginDemoHandler">
</bean>
<bean id="SessionInitHandler" class="com.rapidbackend.core.process.handler.session.SessionInitHandler">
    <property name="sessionStore"  ref="SessionStore"></property>
    <property name="sessionShardingkeyFactory" ref="SessionShardingkeyFactory"></property>
</bean>
<bean id="SessionStoreHandler" class="com.rapidbackend.core.process.handler.session.SessionStoreHandler">
    <property name="sessionStore"  ref="SessionStore"></property>
</bean>
<bean id="SessionShardingkeyFactory" class="com.rapidbackend.core.process.handler.session.DefaultShardingkeyFactory">
    <property name="keyParam"  ref="userId"></property>
</bean>
<bean id="SessionStore" class="com.rapidbackend.security.session.SessionStore">
    <property name="redisCache"  ref="SessionCache"></property>
</bean>

<bean id="CommandDispatcher" class="com.rapidbackend.webserver.netty.command.DefaultCommandDispatcher">
<property name="config"><!-- be careful, the k-v config is case sensitive -->
  <list>
  <value>/Test,Test</value>
  <value>/SessionExpire,SessionExpire</value>
  <value>/,Test</value>
  <value>/Login,Login</value>
  </list>
</property>
</bean>

<bean id="SecurityManager" class="com.rapidbackend.security.shiro.SimpleSecurityManager" scope="prototype">
    <!-- Single realm app.  If you have multiple realms, use the 'realms' property instead. -->
    <property name="realm" ref="PlainUserNamePasswordRealm"/>
    <!-- <property name="sessionManager" ref="DiabledSessionManager" /> -->
</bean>
<bean id="PlainUserNamePasswordRealm" class="com.rapidbackend.security.shiro.PlainUserNamePasswordRealm">
<property name="credentialsMatcher" ref="CredentialsMatcher"/>
<property name="supportedCommands">
<list>
<value>Test</value>
<value>Login</value>
</list>
</property>
</bean>

</beans>